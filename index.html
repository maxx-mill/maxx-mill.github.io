<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maxx Millstein - Portfolio</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --text-color: #1f2937;
            --light-bg: #f3f4f6;
            --white: #ffffff;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --gradient: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            --card-hover-transform: translateY(-5px);
            --transition-speed: 0.3s;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--light-bg);
        }
        
        header {
            background: var(--gradient);
            color: var(--white);
            padding: 1.5rem 0;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--white);
            text-decoration: none;
        }
        
        .nav-menu {
            list-style: none;
            display: flex;
        }
        
        .nav-menu li {
            margin-left: 1.5rem;
        }
        
        .nav-menu a {
            color: var(--white);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }
        
        .nav-menu a:hover {
            color: var(--primary-color);
        }
        
        .active {
            color: var(--primary-color) !important;
        }
        
        .mobile-menu-btn {
            display: none;
            cursor: pointer;
            background: none;
            border: none;
            color: var(--white);
            font-size: 1.5rem;
        }
        
        #home {
            min-height: 85vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 2rem 0;
        }
        
        .hero {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 2rem;
            position: relative;
            overflow: hidden;
        }
        
        .hero::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(37, 99, 235, 0.1) 0%, rgba(37, 99, 235, 0) 70%);
            z-index: -1;
            animation: pulse 8s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.2); opacity: 0.3; }
            100% { transform: scale(1); opacity: 0.5; }
        }
        
        .hero-content {
            flex: 1;
            animation: fadeInUp 1s ease-out;
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .hero-image {
            flex: 1;
            text-align: center;
            height: 400px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
            position: relative;
        }
        
        .hero-image #map {
            width: 100%;
            height: 100%;
            border-radius: 12px;
        }
        
        h1 {
            font-size: 3rem;
            margin-bottom: 1.5rem;
            color: var(--secondary-color);
            font-weight: 700;
            line-height: 1.2;
        }
        
        h2 {
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
            color: var(--secondary-color);
            font-weight: 600;
            line-height: 1.2;
        }
        
        p {
            margin-bottom: 1.5rem;
            font-size: 1.125rem;
            color: var(--text-color);
            line-height: 1.7;
        }
        
        .btn {
            display: inline-block;
            background: var(--gradient);
            color: var(--white);
            padding: 0.8rem 1.5rem;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            margin-right: 1rem;
            margin-bottom: 1rem;
            font-weight: 500;
            border: none;
            box-shadow: var(--shadow);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px -2px rgba(0, 0, 0, 0.15);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
        }
        
        .btn-outline:hover {
            background: var(--gradient);
            color: var(--white);
            border-color: transparent;
        }
        
        .social-links {
            margin-top: 2rem;
        }
        
        .social-links a {
            margin-right: 1rem;
            font-size: 1.5rem;
            color: var(--secondary-color);
            transition: color 0.3s;
        }
        
        .social-links a:hover {
            color: var(--primary-color);
        }
        
        section {
            padding: 4rem 0;
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .section-title h2 {
            font-size: 2.2rem;
            position: relative;
            display: inline-block;
            padding-bottom: 1rem;
        }
        
        .section-title h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 4px;
            background-color: var(--primary-color);
        }
        
        .card {
            background-color: var(--white);
            border-radius: 16px;
            box-shadow: var(--shadow);
            padding: 2rem;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 20px -8px rgba(0, 0, 0, 0.15);
        }
        
        .card h3 {
            margin-bottom: 1rem;
            color: var(--secondary-color);
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }
        
        .map-card {
            position: relative;
            overflow: hidden;
            border-radius: 10px;
            box-shadow: var(--shadow);
        }
        
        .map-card img {
            width: 100%;
            height: 250px;
            object-fit: cover;
            transition: transform 0.3s;
        }
        
        .map-card:hover img {
            transform: scale(1.05);
        }
        
        .map-info {
            background-color: rgba(44, 62, 80, 0.9);
            color: var(--white);
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 1rem;
            transform: translateY(100%);
            transition: transform 0.3s;
        }
        
        .map-card:hover .map-info {
            transform: translateY(0);
        }
        
        .map-info h3 {
            color: var(--white);
            margin-bottom: 0.5rem;
        }
        
        footer {
            background-color: var(--secondary-color);
            color: var(--white);
            padding: 2rem 0;
            text-align: center;
        }
        
        footer a {
            color: var(--primary-color);
            text-decoration: none;
        }
        
        @media (max-width: 768px) {
            .hero {
                flex-direction: column-reverse;
                text-align: center;
            }
            
            .hero-image {
                height: 300px;
                margin: 0 1rem;
            }
            
            .hero-image img {
                width: 200px;
                height: 200px;
            }
            
            .nav-menu {
                position: fixed;
                top: 70px;
                left: -100%;
                flex-direction: column;
                background-color: var(--secondary-color);
                width: 100%;
                text-align: center;
                transition: 0.3s;
                box-shadow: var(--shadow);
                padding: 1rem 0;
                z-index: 100;
            }
            
            .nav-menu.active {
                left: 0;
            }
            
            .nav-menu li {
                margin: 1rem 0;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .section-title h2 {
                font-size: 1.8rem;
            }
        }
        
        .skills-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .skill-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: all var(--transition-speed) ease;
        }
        
        .skill-card:hover {
            transform: var(--card-hover-transform);
            box-shadow: 0 12px 20px -8px rgba(0, 0, 0, 0.15);
        }
        
        .skill-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }
        
        .skill-name {
            font-weight: 600;
            color: var(--secondary-color);
        }
        
        .skill-details {
            font-size: 0.875rem;
            color: var(--text-color);
        }
        
        .projects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        
        .project-card {
            background: var(--white);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all var(--transition-speed) ease;
            padding: 1.5rem;
        }
        
        .project-card:hover {
            transform: var(--card-hover-transform);
            box-shadow: 0 12px 20px -8px rgba(0, 0, 0, 0.15);
        }
        
        .project-content {
            padding: 0;
        }
        
        .project-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--secondary-color);
            margin-bottom: 0.5rem;
        }
        
        .project-description {
            color: var(--text-color);
            margin-bottom: 1rem;
        }
        
        .project-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .project-tag {
            background: var(--light-bg);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            color: var(--secondary-color);
        }

        .leaflet-control-geocoder {
            border-radius: 8px;
            box-shadow: var(--shadow);
            max-width: 200px;
        }

        .leaflet-control-geocoder-form input {
            border-radius: 4px;
            padding: 6px 12px;
            font-family: 'Inter', sans-serif;
            width: 100%;
            border: 1px solid rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .leaflet-control-geocoder-form input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
        }

        .leaflet-control-geocoder-error {
            color: #dc2626;
            font-size: 0.875rem;
            margin-top: 4px;
            display: none;
        }

        .leaflet-control-geocoder-error.visible {
            display: block;
        }

        .leaflet-control-geocoder-form.loading::after {
            content: '';
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
            border: 2px solid var(--primary-color);
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: translateY(-50%) rotate(360deg); }
        }

        .search-history-container {
            position: absolute;
            top: 50px;
            left: 50px;
            z-index: 1000;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            width: 200px;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
        }

        .search-history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .search-history-item:last-child {
            border-bottom: none;
        }

        .history-text {
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
        }

        .history-btn {
            background: none;
            border: none;
            cursor: pointer;
            margin-left: 8px;
        }

        .clear-history-btn {
            width: 100%;
            background: var(--light-bg);
            border: none;
            border-radius: 4px;
            padding: 5px;
            margin-top: 10px;
            font-size: 0.8rem;
            cursor: pointer;
        }

        .clear-history-btn:hover {
            background: #e5e7eb;
        }

        .map-notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background-color: var(--secondary-color);
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 9999;
            opacity: 0;
            transition: transform 0.3s, opacity 0.3s;
        }

        .map-notification.visible {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .bounce-marker {
            animation: bounce 0.5s ease-in-out;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .pulse-marker {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }

        .custom-popup .leaflet-popup-content-wrapper {
            border-radius: 8px;
            box-shadow: 0 3px 14px rgba(0,0,0,0.2);
        }

        .custom-popup .leaflet-popup-content {
            margin: 12px;
        }

        .custom-popup .leaflet-popup-tip {
            box-shadow: 0 3px 14px rgba(0,0,0,0.2);
        }

        .leaflet-control-layers {
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 4px 8px;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            font-size: 0.9rem;
        }

        .leaflet-control-layers-toggle {
            background-color: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            border-radius: 4px;
            width: 26px;
            height: 26px;
        }

        .leaflet-control-layers-expanded {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            padding: 4px 8px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            min-width: 120px;
        }

        .leaflet-control-layers-expanded .leaflet-control-layers-list {
            position: relative;
            display: inline-block;
            vertical-align: middle;
            height: auto;
            margin: 0;
            padding: 0;
        }

        .leaflet-control-layers-expanded .leaflet-control-layers-list label {
            display: block;
            margin: 0;
            padding: 2px 0;
            color: var(--text-color);
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .leaflet-control-layers-expanded .leaflet-control-layers-list input[type="radio"],
        .leaflet-control-layers-expanded .leaflet-control-layers-list input[type="checkbox"] {
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <nav>
                <a href="#" class="logo">Maxx Millstein</a>
                <ul class="nav-menu">
                    <li><a href="index.html" class="active">Home</a></li>
                    <li><a href="maps.html">Web Maps</a></li>
                    <li><a href="#contact">Contact</a></li>
                </ul>
                <button class="mobile-menu-btn">☰</button>
            </nav>
        </div>
    </header>
    
    <section id="home">
        <div class="container">
            <div class="hero">
                <div class="hero-content">
                    <h1>Hi, I'm <span style="color: var(--primary-color);">Maxx Millstein</span></h1>
                    <p>I'm a web developer and GIS specialist passionate about leveraging AI to automate GIS processes and create informative visualizations that make complex spatial data accessible and engaging.</p>
                    <div>
                        <a href="maps.html" class="btn">View My Maps</a>
                        <a href="https://github.com/maxx-mill" target="_blank" class="btn btn-outline">GitHub Profile</a>
                        <a href="Maxx Millstein Resume.pdf" class="btn btn-outline" download>Download Resume</a>
                    </div>
                    <div class="social-links">
                        <a href="https://github.com/maxx-mill" target="_blank" title="GitHub">
                            <i>🐱</i>
                        </a>
                    </div>
                </div>
                <div class="hero-image">
                    <div id="map"></div>
                </div>
            </div>
        </div>
    </section>
    
    <section id="skills" style="background-color: var(--light-bg);">
        <div class="container">
            <div class="section-title">
                <h2>Skills & Expertise</h2>
            </div>
            <div class="skills-grid">
                <div class="skill-card">
                    <div class="skill-icon">🌐</div>
                    <div class="skill-name">Web Development</div>
                    <div class="skill-details">HTML, CSS, JavaScript, React</div>
                </div>
                <div class="skill-card">
                    <div class="skill-icon">🗺️</div>
                    <div class="skill-name">GIS & Mapping</div>
                    <div class="skill-details">ArcGIS, QGIS, Leaflet, Mapbox</div>
                </div>
                <div class="skill-card">
                    <div class="skill-icon">🤖</div>
                    <div class="skill-name">AI & Automation</div>
                    <div class="skill-details">Python, Machine Learning, RPA</div>
                </div>
                <div class="skill-card">
                    <div class="skill-icon">📊</div>
                    <div class="skill-name">Data Analysis</div>
                    <div class="skill-details">SQL, Python, Data Visualization</div>
                </div>
            </div>
        </div>
    </section>
    
    <section id="about" style="background-color: var(--white);">
        <div class="container">
            <div class="section-title">
                <h2>About Me</h2>
            </div>
            <div class="card">
                <p>Welcome to my portfolio! I'm a GIS Specialist and Web Developer with a passion for creating innovative solutions that combine spatial data analysis with modern web technologies. My experience spans across various industries, from environmental consulting to urban planning, where I've developed expertise in GIS automation, web mapping, and data visualization.</p>
                <p>My technical skills include:</p>
                <ul style="margin-left: 2rem; margin-bottom: 1.5rem;">
                    <li>Web Development: HTML, CSS, JavaScript, React</li>
                    <li>GIS & Mapping: ArcGIS, QGIS, Leaflet, Mapbox</li>
                    <li>Programming: Python, SQL, R</li>
                    <li>Data Analysis & Visualization: D3.js, Matplotlib, Folium</li>
                    <li>AI & Automation: Machine Learning, RPA, Process Automation</li>
                </ul>
                <a href="maps.html" class="btn">Explore My Map Projects</a>
            </div>
        </div>
    </section>
    
    <section id="projects" style="background-color: var(--light-bg);">
        <div class="container">
            <div class="section-title">
                <h2>Featured Projects</h2>
            </div>
            <div class="projects-grid">
                <div class="project-card">
                    <div class="project-content">
                        <h3 class="project-title">GIS Process Automation</h3>
                        <p class="project-description">Developed automated workflows for spatial data processing and analysis using Python and ArcGIS, reducing processing time by 75%.</p>
                        <div class="project-tags">
                            <span class="project-tag">Python</span>
                            <span class="project-tag">ArcGIS</span>
                            <span class="project-tag">Automation</span>
                        </div>
                    </div>
                </div>
                <div class="project-card">
                    <div class="project-content">
                        <h3 class="project-title">Interactive Web Mapping Platform</h3>
                        <p class="project-description">Built a responsive web application for visualizing and analyzing spatial data using React and Mapbox GL.</p>
                        <div class="project-tags">
                            <span class="project-tag">React</span>
                            <span class="project-tag">Mapbox GL</span>
                            <span class="project-tag">JavaScript</span>
                        </div>
                    </div>
                </div>
                <div class="project-card">
                    <div class="project-content">
                        <h3 class="project-title">Data Analysis Dashboard</h3>
                        <p class="project-description">Created an interactive dashboard for environmental data analysis and visualization using D3.js and Python.</p>
                        <div class="project-tags">
                            <span class="project-tag">D3.js</span>
                            <span class="project-tag">Python</span>
                            <span class="project-tag">Data Analysis</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <section id="contact">
        <div class="container">
            <div class="section-title">
                <h2>Get In Touch</h2>
            </div>
            <div class="card" style="max-width: 600px; margin: 0 auto;">
                <p>I'm always interested in new projects and opportunities. Feel free to reach out to me via email or connect with me on social media.</p>
                <p><strong>Email:</strong> millsteinm@gmail.com</p>
                <div class="social-links" style="text-align: center;">
                    <a href="https://github.com/maxx-mill" target="_blank" title="GitHub">
                        <i>🐱</i>
                    </a>
                </div>
            </div>
        </div>
    </section>
    
    <footer>
        <div class="container">
            <p>&copy; 2025 Maxx Millstein. All rights reserved.</p>
        </div>
    </footer>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <script>
        // Mobile Menu Toggle
        const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
        const navMenu = document.querySelector('.nav-menu');
        
        mobileMenuBtn.addEventListener('click', () => {
            navMenu.classList.toggle('active');
        });
        
        // Close mobile menu when clicking on a link
        document.querySelectorAll('.nav-menu a').forEach(link => {
            link.addEventListener('click', () => {
                navMenu.classList.remove('active');
            });
        });

        // Create a search history manager
        const searchHistoryManager = {
            history: JSON.parse(localStorage.getItem('mapSearchHistory') || '[]'),
            maxItems: 5,
            
            add(query, result) {
                if (this.history.some(item => item.query === query)) {
                    this.history = this.history.filter(item => item.query !== query);
                }
                
                this.history.unshift({ 
                    query, 
                    name: result.name,
                    latlng: [result.center.lat, result.center.lng] 
                });
                
                if (this.history.length > this.maxItems) {
                    this.history = this.history.slice(0, this.maxItems);
                }
                
                localStorage.setItem('mapSearchHistory', JSON.stringify(this.history));
                this.updateUI();
            },
            
            clear() {
                this.history = [];
                localStorage.removeItem('mapSearchHistory');
                this.updateUI();
            },
            
            updateUI() {
                const historyContainer = document.getElementById('search-history');
                if (!historyContainer) return;
                
                historyContainer.innerHTML = '';
                
                if (this.history.length === 0) {
                    historyContainer.style.display = 'none';
                    return;
                }
                
                historyContainer.style.display = 'block';
                
                this.history.forEach((item, index) => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'search-history-item';
                    historyItem.innerHTML = `
                        <span class="history-text">${item.name}</span>
                        <button class="history-btn" data-index="${index}" title="Search this location again">↗️</button>
                    `;
                    historyContainer.appendChild(historyItem);
                    
                    historyItem.querySelector('.history-btn').addEventListener('click', () => {
                        map.setView(item.latlng, 13);
                        displayMarkerAtLatLng(item.latlng, item.name);
                        const searchInput = document.querySelector('.leaflet-control-geocoder-form input');
                        if (searchInput) searchInput.value = item.name;
                    });
                });
                
                const clearButton = document.createElement('button');
                clearButton.className = 'clear-history-btn';
                clearButton.textContent = 'Clear History';
                clearButton.addEventListener('click', () => this.clear());
                historyContainer.appendChild(clearButton);
            }
        };

        // Function to display marker at a specific lat/lng
        function displayMarkerAtLatLng(latlng, title) {
            map.eachLayer((layer) => {
                if (layer instanceof L.Marker) {
                    map.removeLayer(layer);
                }
            });
            
            const marker = L.marker(latlng, {
                title: title,
                animation: true
            }).addTo(map);
            
            const popupContent = `
                <div style="font-family: 'Inter', sans-serif; max-width: 250px;">
                    <h3 style="margin: 0 0 8px 0; color: var(--secondary-color); font-size: 1.1rem;">${title}</h3>
                </div>
            `;
            
            marker.bindPopup(popupContent).openPopup();
            
            marker._icon.classList.add('pulse-marker');
            setTimeout(() => {
                marker._icon.classList.remove('pulse-marker');
            }, 2000);
        }

        // Create search history UI
        const searchHistoryHTML = `
            <div id="search-history" class="search-history-container" style="display: none;"></div>
        `;
        
        const mapContainer = document.getElementById('map');
        const searchHistoryElement = document.createElement('div');
        searchHistoryElement.innerHTML = searchHistoryHTML;
        mapContainer.appendChild(searchHistoryElement.firstChild);

        // Show notification toast
        function showNotification(message, duration = 3000) {
            let notification = document.getElementById('map-notification');
            if (!notification) {
                notification = document.createElement('div');
                notification.id = 'map-notification';
                notification.className = 'map-notification';
                document.body.appendChild(notification);
            }
            
            notification.textContent = message;
            notification.classList.add('visible');
            
            setTimeout(() => {
                notification.classList.remove('visible');
            }, duration);
        }

        // Format address nicely
        function formatAddress(address) {
            const priorities = ['house_number', 'road', 'neighbourhood', 'suburb', 'city', 'town', 'state', 'postcode'];
            let formatted = '';
            
            priorities.forEach(key => {
                if (address[key]) {
                    formatted += `<div>${address[key]}</div>`;
                }
            });
            
            Object.entries(address)
                .filter(([key]) => !priorities.includes(key) && !['country_code', 'country'].includes(key))
                .forEach(([key, value]) => {
                    formatted += `<div>${value}</div>`;
                });
                
            return formatted;
        }

        // Initialize the map
        const map = L.map('map', {
            center: [38.6270, -90.1994], // St. Louis coordinates
            zoom: 11,
            zoomControl: false,
            attributionControl: false,
            maxBoundsViscosity: 0.5 // Make bounds less restrictive
        });

        // Add satellite imagery layer
        const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
        }).addTo(map);

        // Add street map layer
        const streetLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        });

        // Add layer control
        const baseMaps = {
            "Satellite": satelliteLayer,
            "Street": streetLayer
        };
        L.control.layers(baseMaps, null, {
            position: 'topright',
            collapsed: false
        }).addTo(map);

        // Add search control with enhanced functionality
        const geocoder = L.Control.geocoder({
            defaultMarkGeocode: false,
            placeholder: 'Search locations...',
            errorMessage: 'Nothing found.',
            position: 'topleft',
            queryMinLength: 3,
            suggestMinLength: 3,
            suggestTimeout: 250,
            expanded: true,
            geocoder: L.Control.Geocoder.nominatim({
                geocodingQueryParams: {
                    limit: 8,
                    addressdetails: 1,
                    'accept-language': 'en'
                }
            })
        }).on('markgeocode', function(e) {
            try {
                const latlng = e.geocode.center;
                const bounds = e.geocode.bbox;
                
                map.eachLayer((layer) => {
                    if (layer instanceof L.Marker) {
                        map.removeLayer(layer);
                    }
                });

                const marker = L.marker(latlng, {
                    title: e.geocode.name
                }).addTo(map);
                
                if (marker._icon) {
                    marker._icon.classList.add('bounce-marker');
                    setTimeout(() => {
                        marker._icon.classList.remove('bounce-marker');
                    }, 1000);
                }

                const popupContent = `
                    <div style="font-family: 'Inter', sans-serif; max-width: 250px;">
                        <h3 style="margin: 0 0 8px 0; color: var(--secondary-color); font-size: 1.1rem;">${e.geocode.name}</h3>
                        ${e.geocode.properties?.address ? `
                            <div style="margin: 0; font-size: 0.9rem; color: var(--text-color); line-height: 1.4;">
                                ${formatAddress(e.geocode.properties.address)}
                            </div>
                            <div class="popup-actions" style="margin-top: 10px; display: flex; gap: 5px;">
                                <button class="btn-copy-coords" style="font-size: 0.8rem; padding: 3px 6px; background: var(--light-bg); border: none; border-radius: 4px; cursor: pointer;">
                                    Copy Coordinates
                                </button>
                                <button class="btn-directions" style="font-size: 0.8rem; padding: 3px 6px; background: var(--light-bg); border: none; border-radius: 4px; cursor: pointer;">
                                    Get Directions
                                </button>
                            </div>
                        ` : ''}
                    </div>
                `;

                const popup = L.popup({ 
                    closeButton: true,
                    autoClose: false,
                    className: 'custom-popup'
                })
                .setLatLng(latlng)
                .setContent(popupContent)
                .openOn(map);
                
                setTimeout(() => {
                    const copyBtn = document.querySelector('.btn-copy-coords');
                    const directionsBtn = document.querySelector('.btn-directions');
                    
                    if (copyBtn) {
                        copyBtn.addEventListener('click', () => {
                            navigator.clipboard.writeText(`${latlng.lat.toFixed(6)}, ${latlng.lng.toFixed(6)}`).then(() => {
                                showNotification('Coordinates copied to clipboard!');
                            });
                        });
                    }
                    
                    if (directionsBtn) {
                        directionsBtn.addEventListener('click', () => {
                            window.open(`https://www.google.com/maps/dir/?api=1&destination=${latlng.lat},${latlng.lng}`, '_blank');
                        });
                    }
                }, 100);

                // Update the view handling
                if (bounds) {
                    map.flyToBounds(bounds, {
                        padding: [50, 50],
                        maxZoom: 15,
                        animate: true,
                        duration: 1.5,
                        noMoveStart: true // Prevent unwanted move events
                    });
                } else {
                    map.flyTo(latlng, 13, {
                        animate: true,
                        duration: 1.5,
                        noMoveStart: true // Prevent unwanted move events
                    });
                }
                
                // Store the last searched location
                map.lastSearchedLocation = latlng;
                
                searchHistoryManager.add(e.geocode.name, {
                    name: e.geocode.name,
                    center: latlng
                });
                
            } catch (error) {
                console.error('Error handling geocode result:', error);
                showError('Error displaying location. Please try again.');
            }
        }).addTo(map);

        // Add zoom control
        L.control.zoom({
            position: 'bottomright'
        }).addTo(map);

        // Add scale control
        L.control.scale({
            imperial: true,
            metric: true,
            position: 'bottomleft',
            maxWidth: 200
        }).addTo(map);

        // Add a marker at St. Louis only on initial load
        const stLouisMarker = L.marker([38.6270, -90.1994]).addTo(map)
            .bindPopup('Welcome to my portfolio!<br>📍 St. Louis, MO')
            .openPopup();

        // Remove St. Louis marker when searching
        map.on('moveend', function() {
            if (map.lastSearchedLocation) {
                stLouisMarker.remove();
            }
        });

        // Add error handling and loading states
        function showError(message) {
            const errorDiv = document.querySelector('.leaflet-control-geocoder-error');
            if (!errorDiv) {
                const container = document.querySelector('.leaflet-control-geocoder');
                if (container) {
                    const newErrorDiv = document.createElement('div');
                    newErrorDiv.className = 'leaflet-control-geocoder-error';
                    container.appendChild(newErrorDiv);
                }
            }
            
            const updatedErrorDiv = document.querySelector('.leaflet-control-geocoder-error');
            if (updatedErrorDiv) {
                updatedErrorDiv.textContent = message;
                updatedErrorDiv.classList.add('visible');
                updatedErrorDiv.style.display = 'block';
                
                setTimeout(() => {
                    updatedErrorDiv.classList.remove('visible');
                    updatedErrorDiv.style.display = 'none';
                }, 3000);
            }
        }

        // Enhanced search handler
        const searchInput = document.querySelector('.leaflet-control-geocoder-form input');
        if (searchInput) {
            let searchTimeout;
            
            searchInput.style.transition = 'all 0.2s ease';
            searchInput.style.border = '1px solid #ddd';
            
            searchInput.addEventListener('focus', function() {
                this.style.boxShadow = '0 0 0 3px rgba(37, 99, 235, 0.2)';
                this.style.border = '1px solid var(--primary-color)';
                
                if (searchHistoryManager.history.length > 0) {
                    searchHistoryManager.updateUI();
                }
            });
            
            searchInput.addEventListener('blur', function() {
                this.style.boxShadow = 'none';
                this.style.border = '1px solid #ddd';
                
                setTimeout(() => {
                    const historyContainer = document.getElementById('search-history');
                    if (historyContainer) {
                        historyContainer.style.display = 'none';
                    }
                }, 300);
            });

            const placeholders = [
                'Search for a location...',
                'Try "Forest Park, St. Louis"',
                'Try "Gateway Arch"',
                'Search for "Busch Stadium"',
                'Find "Soulard, St. Louis"'
            ];
            
            let placeholderIndex = 0;
            
            function cyclePlaceholder() {
                placeholderIndex = (placeholderIndex + 1) % placeholders.length;
                searchInput.placeholder = placeholders[placeholderIndex];
            }
            
            setInterval(cyclePlaceholder, 3000);

            searchInput.addEventListener('input', function(e) {
                const query = this.value.trim();
                
                if (searchTimeout) {
                    clearTimeout(searchTimeout);
                }

                this.parentElement.classList.add('loading');

                searchTimeout = setTimeout(() => {
                    if (query.length >= 3) {
                        geocoder.options.geocoder.geocode(query, function(results) {
                            searchInput.parentElement.classList.remove('loading');

                            if (results && results.length > 0) {
                                showError('');
                            } else {
                                showError('No locations found. Try a different search term.');
                            }
                        });
                    } else {
                        this.parentElement.classList.remove('loading');
                        
                        if (query.length > 0 && query.length < 3) {
                            showError('Enter at least 3 characters to search');
                        }
                    }
                }, 300);
            });

            searchInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const query = this.value.trim();
                    
                    if (query.length >= 3) {
                        this.parentElement.classList.add('loading');
                        showNotification(`Searching for "${query}"...`, 1500);

                        geocoder.options.geocoder.geocode(query, function(results) {
                            searchInput.parentElement.classList.remove('loading');

                            if (results && results.length > 0) {
                                geocoder.fire('markgeocode', {
                                    geocode: results[0]
                                });
                            } else {
                                showError('No locations found. Please try a different search.');
                            }
                        });
                    } else {
                        showError('Please enter at least 3 characters to search.');
                    }
                } else if (e.key === 'Escape') {
                    this.value = '';
                    this.blur();
                    showError('');
                }
            });
            
            // Current location feature
            const currentLocationBtn = document.createElement('button');
            currentLocationBtn.className = 'current-location-btn';
            currentLocationBtn.innerHTML = '📍';
            currentLocationBtn.title = 'Use my current location';
            currentLocationBtn.style.cssText = `
                position: absolute;
                right: 8px;
                top: 50%;
                transform: translateY(-50%);
                background: none;
                border: none;
                font-size: 18px;
                cursor: pointer;
                z-index: 1000;
            `;
            
            searchInput.parentElement.style.position = 'relative';
            searchInput.parentElement.appendChild(currentLocationBtn);
            
            currentLocationBtn.addEventListener('click', () => {
                if ('geolocation' in navigator) {
                    showNotification('Getting your location...');
                    
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const latlng = [position.coords.latitude, position.coords.longitude];
                            
                            geocoder.options.geocoder.reverse(
                                { lat: latlng[0], lng: latlng[1] },
                                map.options.crs.scale(map.getZoom()),
                                results => {
                                    let locationName = 'Current Location';
                                    
                                    if (results && results.length > 0) {
                                        locationName = results[0].name;
                                    }
                                    
                                    map.setView(latlng, 15);
                                    displayMarkerAtLatLng(latlng, locationName);
                                    searchInput.value = locationName;
                                    
                                    searchHistoryManager.add(locationName, {
                                        name: locationName,
                                        center: { lat: latlng[0], lng: latlng[1] }
                                    });
                                    
                                    showNotification('Location found!');
                                }
                            );
                        },
                        (error) => {
                            let errorMsg = 'Unable to get your location';
                            
                            switch(error.code) {
                                case error.PERMISSION_DENIED:
                                    errorMsg = 'Location access denied. Please enable location permissions.';
                                    break;
                                case error.POSITION_UNAVAILABLE:
                                    errorMsg = 'Location information unavailable.';
                                    break;
                                case error.TIMEOUT:
                                    errorMsg = 'Location request timed out.';
                                    break;
                            }
                            
                            showNotification(errorMsg);
                        },
                        { 
                            enableHighAccuracy: true, 
                            timeout: 10000 
                        }
                    );
                } else {
                    showNotification('Geolocation is not supported by your browser');
                }
            });
        }

        // Initialize search history UI
        searchHistoryManager.updateUI();
    </script>
</body>
</html>